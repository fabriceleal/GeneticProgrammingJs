<html>
<head>
<script src="jquery-1.8.1.min.js"></script>
<script src="jquery.flot.js"></script>
<script type="text/javascript">
	// So it can be accessed from the browser console, for testing ...
	var thread;
	
	$(function(){		
		var optimize = 'function(x){ return x*x + x + 1; }';
		
		$('#logs-content').append(new Date() + ': to optimize: ' + optimize + '<br/ >');

		// Plot the function to approximate
		var testValues = [], original, fn = eval('(function(){ return (' + optimize + ');})()');
		for(var i = -1, y = 0; i <=1; i+=0.1, ++y){
			testValues.push(i);
		}
		original = testValues.map(function(i){ return [i, fn(i)];})
		
		$.plot($('#plot'), [{label:"original", data:original, points:{ show:true }}]);
		thread = new Worker("exec.js");

		thread.addEventListener("message", function(event){
			$('#logs-content').append(new Date() + ': ' + event.data.name + ' result: ' + JSON.stringify(event.data.data) + "<br/ > ");

			if(event.data.name === "load")
				thread.postMessage({ name:"generator", data: { maxDepth: 10 }});
			if(event.data.name === "generator")
				thread.postMessage({ name:"population", data: { number: 50 } });
			if(event.data.name === "population")
				thread.postMessage({ name:"evolver" , data: { fn: optimize }});
			if(event.data.name === "evolver")
				thread.postMessage({ name:"start" , data: { type: "evolve", arg: 7 }});
			if(event.data.name === "start") {
				// plot best, if found
				if(!event.data.data.err && event.data.data.result){
					var best = eval('(function(){ return (' + event.data.data.result.best + ');})()');
					var bestData = testValues.map(function(i){ return [i, best(i)];});

					$.plot($('#plot'), [{label:"original", data:original, points:{ show:true }}, {label:"best", data:bestData}]);
				}
			}
		}, false);

		thread.postMessage({ name:"load", data: { }});
	});

</script>
</head>
<body>
<h1>Genetic programming with madmonkey and gpjs</h1>
<h2>Approximate numerical function R -> R</h2>
<div id="parameters"></div>
<div id="plot" style="width:600px;height:300px"></div>
<div id="logs">
<i>If the best error is something like 4.440892098500626e-16, one can say that we matched the original function!</i><br/ >
<b>Logs:</b>
<div id="logs-content"></div>
</div>
<br/ >
<i>Plot generated using <a href="http://www.flotcharts.org/">flot</a>. <br/>
Genetic programming implemented with <a href="https://github.com/fabriceleal/MadMonkeyJs">madmonkey</a> and <a href="https://github.com/fabriceleal/GeneticProgrammingJs">gpjs</a>.</i>
</body>
</html>
